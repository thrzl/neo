---
const {
    backgroundColor = "bg-green-9",
    title = "planet",
    description = "a home for all my hopes, dreams, thoughts and schemes",
    showHeader = true,
    pageTitle = "",
    fullTitle = "",
} = Astro.props;
import Html from "./Html.astro";
import Sidebar from "../components/Sidebar.astro";
import Footer from "../components/Footer.astro";
import Sun from "../assets/sun.svg";

const italicizedWord = fullTitle.split(" ").pop();
const trueTitle = fullTitle.split(" ").slice(0, -1).join(" ");
---

<Html backgroundColor={backgroundColor} title={pageTitle}>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            requestAnimationFrame(() => {
                document.body.style.transition = "";
                document.documentElement.classList.add("colors-fade");

                const dynamicElements =
                    document.querySelectorAll('[class*="cover-"]');
                dynamicElements.forEach((el) => {
                    el.classList.forEach((cls) => {
                        const match = cls.match(
                            /^(text|bg|border)-cover-(.+)$/,
                        );
                        if (match) {
                            if (
                                !(
                                    el.classList.contains(
                                        "transition-colors",
                                    ) && el.classList.contains("duration-200")
                                )
                            )
                                // el.classList.add("colors-fade");
                                console.log("");
                        }
                    });
                });
            });
            const scrollPosition = sessionStorage.getItem("scrollPosition");
            if (scrollPosition) {
                window.scrollTo(0, parseInt(scrollPosition, 10));
            }
            document.documentElement.style.scrollBehavior = "smooth";
            document.addEventListener("visibilitychange", () => {
                sessionStorage.setItem(
                    "scrollPosition",
                    window.scrollY.toString(),
                );
            });
        });
    </script>

    <div
        class="grid grid-cols-[100vw_100vw_0] lg:grid-cols-[25%_50%_25%] justify-center overflow-x-auto snap-x snap-mandatory lg:overflow-x-visible lg:snap-none min-w-screen"
        style="color: var(--accent-text)"
    >
        <Sidebar class="snap-start min-w-full lg:min-w-0" />
        <main
            class="relative self-start text-center inline-block w-full min-h-screen px-8 pt-16 lg:mt-16 mb-16 snap-start min-w-full lg:min-w-0"
        >
            {
                showHeader && (
                    <div class="b-cover-accent b-4 b-solid flex flex-col justify-end w-80vw lg:w-full min-h-3/4 py-4 my-4">
                        <h1 class="text-5xl font-bold z-1 text-wrap px-2">
                            {fullTitle ? (
                                <>
                                    {trueTitle} <i> {italicizedWord}</i>
                                </>
                            ) : (
                                <>
                                    thrizzle's{" "}
                                    <span class="italic">{title}</span>
                                </>
                            )}
                        </h1>
                        <p class="b-t-dotted b-t-1 b-t-cover-muted w-max mx-auto mb-2 print-hidden">
                            {description}
                        </p>
                    </div>
                )
            }
            <div class="text-left my-4 line-height-snug w-80vw lg:w-full">
                <slot />
            </div>
        </main>
        <div class="hidden lg:block w-full"></div>
    </div>
    <Footer />
    <style is:global>
        .colors-fade * {
            transition-property:
                color, background-color, border-color, text-decoration-color,
                fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 1s;
            transition-delay: 0s;
        }
        :root {
            --dominant: rgba(57, 82, 38, 1);
            --accent-bg: rgba(189, 149, 93, 1);
            --accent-muted-light: rgba(114, 113, 168, 1);
            --accent-bg-light: rgba(127, 174, 98, 1);
            --accent-text: rgba(255, 255, 255, 1);
        }
    </style>
</Html>
