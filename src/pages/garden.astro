---
import Layout from "../layouts/Layout.astro";
import LinkCard from "../components/LinkCard.astro";
import { getCollection, render } from "astro:content";
import type { CollectionEntry } from "astro:content";
import truncate from "html-truncate";
let blogPosts: CollectionEntry<"blog">[] = await getCollection("blog");
const plants = "💐 🌸 🪷 🏵️ 🌹 🥀 🌺 🌻 🌼 🌷 🪻 🌱 🪴 🌵 🌾 🌿 ☘️ 🍀 🍁 🍂 🍃".split(" ")

function chooseFlower(text: string) {
  let hash = 0;
  for (let i = 0; i < text.length; i++) {
    hash = text.charCodeAt(i) + ((hash << 5) - hash);
    hash = hash & hash; // Convert to 32bit integer
  }
  const hashNumber = Math.abs(hash)

  const range = plants.length;
  return plants[hashNumber % range];
}

console.log(chooseFlower("welcome, welcome"))

if (import.meta.env.PROD) {
    blogPosts = blogPosts.filter((post) => !post.data.draft);
}

function formatDate(date: string): string {
    return new Date(date).toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
    });
}
---

<script>
    document.addEventListener("astro:page-load", () => {
        document.querySelectorAll("[copyValue]").forEach((section) => {
            section.addEventListener("click", () => {
                navigator.clipboard.writeText(
                    section.getAttribute("copyValue"),
                );
            });
        });
    });
</script>

<Layout title="garden" description="my thoughts and ruminations">
    <a href="/rss.xml" class="b-b-dotted b-b-2 b-b-green hover:b-b-1">
        <svg
            class="text-orange inline"
            xmlns="http://www.w3.org/2000/svg"
            width="1em"
            height="1em"
            viewBox="0 0 24 24"
            ><path
                fill="currentColor"
                d="M22 2V1H2v1H1v20h1v1h20v-1h1V2zm-6 16v-3h-1v-2h-1v-1h-1v-1h-1v-1h-1V9H9V8H7V7H4V4h3v1h2v1h2v1h2v1h1v1h1v1h1v1h1v2h1v2h1v2h1v3h-3v-2zm-5 0v-2h-1v-1H9v-1H8v-1H6v-1H4V9h2v1h2v1h2v1h1v1h1v1h1v2h1v2h1v2h-3v-2zm-7 1v-3h1v-1h3v1h1v3H8v1H5v-1z"
            ></path></svg
        >
        <!-- from yesicon.app -->
        subscribe via rss
    </a>
    <section class="mt-2 h-feed">
        <span class="hidden p-name">thrizzle's garden</span>
        {
            blogPosts
                .sort((a, b) => {
                    return b.data.date - a.data.date;
                })
                .map((post) => (
                    <Fragment>
                        <article class="h-entry mb-4" id={post.id}>
                            <a
                                href={`/garden/${post.id}`}
                                class="w-max block b-b-dotted b-b-1 b-b-green hover:text-glow hover:b-b-2 relative"
                            >
                                <span class="absolute top-0 -right-3">{chooseFlower(post.data.title)}</span>
                                <h1 class="text-2xl font-bold w-max inline-block cursor-pointer p-name">
                                    {post.data.title}
                                </h1>
                            </a>
                            <a
                                rel="author"
                                class="p-author h-card hidden"
                                href={Astro.site}
                            >
                                thrizzle
                            </a>
                            <time
                                datetime={post.data.date.toISOString()}
                                class="dt-published italic text-base font-normal lowercase op-70"
                            >
                                written on {post.data.date.toDateString()}
                            </time>
                            <div
                                class="prose text-2xl lg:text-lg mt-4 px-4 max-w-full b-4 b-dashed b-green-8 e-content inline-block"
                                set:html={truncate(post.rendered.html, 250)}
                            >
                                {/* oooooo xss.... */}
                            </div>
                        </article>
                    </Fragment>
                ))
        }
        {
            blogPosts.length < 2 && (
                <LinkCard
                    title="more posts coming soon"
                    description="check back later!"
                    disabled
                />
            )
        }
    </section>
</Layout>
