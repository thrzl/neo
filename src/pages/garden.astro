---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import Rss from "../assets/rss.svg"
let blogPosts: CollectionEntry<"blog">[] = await getCollection("blog");
const plants =
	"💐 🌸 🪷 🏵️ 🌹 🥀 🌺 🌻 🌼 🌷 🪻 🌱 🪴 🌵 🌾 🌿 ☘️ 🍀 🍁 🍂 🍃".split(" ");

function chooseFlower(text: string) {
	let hash = 0;
	for (let i = 0; i < text.length; i++) {
		hash = text.charCodeAt(i) + ((hash << 5) - hash);
		hash = hash & hash; // Convert to 32bit integer
	}
	const hashNumber = Math.abs(hash);

	const range = plants.length;
	return plants[hashNumber % range];
}

if (import.meta.env.PROD) {
	blogPosts = blogPosts.filter((post) => !post.data.draft);
}

function formatDate(date: string): string {
	return new Date(date).toLocaleDateString("en-US", {
		year: "numeric",
		month: "long",
		day: "numeric",
	});
}
---

<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll("[copyValue]").forEach((section) => {
            section.addEventListener("click", () => {
              const copyValue = section.getAttribute("copyValue")
              if (!copyValue) return;
              navigator.clipboard.writeText(
                    copyValue,
                );
            });
        });
    });
</script>

<Layout title="garden" description="my thoughts and ruminations">
    <a href="/rss.xml" class="button" style="text-decoration: none; padding-right: 0.25rem">
        <!-- from yesicon.app -->
        subscribe via rss
        <Rss class="inline align-top h-4 w-4"/>
    </a>
    <section class="mt-2 h-feed">
        <span class="hidden p-name">thrizzle's garden</span>
        {
            blogPosts
                .sort((a, b) => {
                    return b.data.date - a.data.date;
                })
                .map((post) => (
                    <Fragment>
                        <article class="h-entry mb-4" id={post.id}>
                            <a
                                href={`/garden/${post.id}`}
                                class="lg:w-max block relative"
                            >
                                <span class="absolute -top-2 -right-5 lg:top-0 lg:-right-3 !decoration-none">
                                    {chooseFlower(post.data.title)}
                                </span>
                                <h1 class="text-6xl font-bold inline-block cursor-pointer p-name link">
                                    {post.data.title}
                                </h1>
                            </a>
                            <a
                                rel="author"
                                class="p-author h-card hidden"
                                href={Astro.site}
                            >
                                thrizzle
                            </a>
                            <p class="text-xl"><time
                                datetime={post.data.date.toISOString()}
                                class="dt-published italic text-base font-bold lowercase op-70"
                            >
                                {post.data.date.toDateString()}
                            </time> {post.data.description}</p>
                            <!-- <div
                                class="prose text-2xl lg:text-lg mt-4 px-4 min-w-full b-4 b-dashed b-cover-bright e-content inline-block"
                                set:html={truncate(post.rendered.html, 250)}
                            >
                                {/* oooooo xss.... */}
                            </div> -->
                        </article>
                    </Fragment>
                ))
        }
        {
            blogPosts.length < 10 && (
            <article class="h-entry mb-4 op-50">
                <a
                    class="w-max link block relative"
                >
                    <span class="absolute -top-2 -right-5 lg:top-0 lg:-right-3">
                        🔭
                    </span>
                    <h1 class="text-6xl font-bold w-max pointer-events-none inline-block p-name">
                        more posts coming soon!
                    </h1>
                </>
            </article>
            )
        }
    </section>
    <style>
    h1 {
        text-wrap: wrap;
    }</style>
</Layout>
